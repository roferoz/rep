let proveedores = JSON.parse(localStorage.getItem('proveedores')) || [];
let indiceEditar = null;
let modoEdicion = false; // NUEVO: variable para saber si estamos editando

function guardarProveedores() {
  localStorage.setItem('proveedores', JSON.stringify(proveedores));
}

function mostrarProveedores(lista) {
  tablaBody.innerHTML = '';
  lista.forEach((proveedor, index) => {
    const nuevaFila = document.createElement('tr');
    nuevaFila.innerHTML = `
      <td>${proveedor.nombre}</td>
      <td>${proveedor.empresa}</td>
      <td>${proveedor.marca}</td>
      <td>${proveedor.rubro}</td>
      <td>${proveedor.nro}</td>
      <td>${proveedor.correo}</td>
      <td>${proveedor.comentarios}</td>
      <td>
        <button class="btn btn-sm btn-info me-1" onclick="mostrarProveedor(${index})">Mostrar</button>
        <button class="btn btn-sm btn-warning" onclick="editarProveedor(${index})">Editar</button>
      </td>
    `;
    tablaBody.appendChild(nuevaFila);
  });
}

function editarProveedor(index) {
  const proveedor = proveedores[index];
  document.getElementById('nombre').value = proveedor.nombre;
  document.getElementById('empresa').value = proveedor.empresa;
  document.getElementById('marca').value = proveedor.marca;
  document.getElementById('rubro').value = proveedor.rubro;
  document.getElementById('nro').value = proveedor.nro;
  document.getElementById('correo').value = proveedor.correo;
  document.getElementById('comentarios').value = proveedor.comentarios;

  indiceEditar = index;
  modoEdicion = true; // Entramos en modo edición
  botonEliminar.classList.remove('d-none');
}

form.addEventListener('submit', function(event) {
  event.preventDefault();

  const nuevoProveedor = {
    nombre: document.getElementById('nombre').value,
    empresa: document.getElementById('empresa').value,
    marca: document.getElementById('marca').value,
    rubro: document.getElementById('rubro').value,
    nro: document.getElementById('nro').value,
    correo: document.getElementById('correo').value,
    comentarios: document.getElementById('comentarios').value
  };

  if (modoEdicion && indiceEditar !== null) {
    proveedores[indiceEditar] = nuevoProveedor; // Actualizamos en el lugar correcto
  } else {
    proveedores.push(nuevoProveedor); // Agregamos nuevo
  }

  guardarProveedores();
  mostrarProveedores(proveedores);
  form.reset();
  botonEliminar.classList.add('d-none');
  indiceEditar = null;
  modoEdicion = false; // Salimos de modo edición
});

function mostrarProveedor(index) {
  const proveedor = proveedores[index];
  detalleProveedor.innerHTML = `
    <strong>Nombre:</strong> ${proveedor.nombre}<br>
    <strong>Empresa:</strong> ${proveedor.empresa}<br>
    <strong>Marca:</strong> ${proveedor.marca}<br>
    <strong>Rubro:</strong> ${proveedor.rubro}<br>
    <strong>Teléfono:</strong> ${proveedor.nro}<br>
    <strong>Correo:</strong> ${proveedor.correo}<br>
    <strong>Comentarios:</strong> ${proveedor.comentarios}
  `;

  // Corrección QR: ahora apunta a hacer llamada
  qr.value = `tel:${proveedor.nro}`;

  const modal = new bootstrap.Modal(document.getElementById('modalMostrar'));
  modal.show();
}

